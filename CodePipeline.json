{
    "Parameters" : {
        "Owner" : {
            "Type" : "String",
            "Description" : "Enter the owner of the pipeline."
        },
        "ServiceName" : {
            "Type" : "String",
            "Description" : "Enter the name of the service to build, test, and deploy."
        },
        "BuildEnvComputeType" : {
            "Type" : "String",
            "Default" : "BUILD_GENERAL1_SMALL",
            "AllowedValues" : ["BUILD_GENERAL1_SMALL", "BUILD_GENERAL1_MEDIUM", "BUILD_GENERAL1_LARGE"],
            "Description" : "Select the compute type for the build environment."
        },
        "BuildEnvImage" : { 
            "Type" : "String",
            "Default" : "aws/codebuild/docker:1.12.1",
            "AllowedValues" : [ "aws/codebuild/docker:1.12.1", "aws/codebuild/ubuntu-base:14.04" ],
            "Description" : "Select the image for the build environment."
        },
        "LambdaHandlerFile" : {
            "Type" : "String",
            "Description" : "Enter the name the file with the Lambda handler function."
        },
        "LambdaCodeS3Path" : {
            "Type" : "String",
            "Description" : "Enter the S3 path to the Lambda function."
        },
        "LambdaZipFileName" : {
            "Type" : "String",
            "Description" : "Enter the name of the zip file containing the Lambda function."
        },
        "CodeBuildServiceRoleARN" : {
            "Type" : "String",
            "Description" : "Enter the CodeBuild service role ARN."
        },
        "GitHubAuthRepo" : {
            "Type" : "String",
            "Description" : "Enter the HTTPS clone URL, including the user name and personal access token, to the repository that contains the source code and the build spec (for example, https://login-user-name:personal-access-token@github.com/repo-owner-name/repo-name.git)"
        },
        "BuildArtifactsLocation" : {
            "Type" : "String",
            "Default" : "sf-te-codebuild-artifacts",
            "Description" : "Enter the S3 bucket where the artifacts will be stored."
        }
    },
    "Resources" : {

        "CodeBuild" : {
            "Type" : "AWS::CodeBuild::Project",
            "Properties" : {
                "Artifacts" : {
                    "Type" : "S3",
                    "Location" : { "Ref" : "BuildArtifactsLocation" },
                    "Path" : { "Ref" : "ServiceName" },
                    "NamespaceType" : "NONE",
                    "Packaging" : "NONE",
                    "Name" : "ratings-service-stack-config.json"
                },
                "Environment" : {
                    "ComputeType" : { "Ref" : "BuildEnvComputeType" },
                    "EnvironmentVariables" : [ 
                        {
                            "Name" : "LAMBDA_HANDLER_FILE",
                            "Value" : { "Ref" : "LambdaHandlerFile" } 
                        },
                        {
                            "Name" : "S3_PATH",
                            "Value" : { "Ref" : "LambdaCodeS3Path" } 
                        },
                        {
                            "Name" : "LAMBDA_ZIP_FILE",
                            "Value" : { "Ref" : "LambdaZipFileName" } 
                        } 
                    ],
                    "Image" : { "Ref" : "BuildEnvImage" },
                    "Type" : "LINUX_CONTAINER"
                },
                "Name" : { "Ref" : "ServiceName" },
                "ServiceRole" : { "Ref" : "CodeBuildServiceRoleARN" },
                "Source" : {
                    "Type" : "GITHUB",
                    "Location" : { "Ref" : "GitHubAuthRepo" }
                },
                "Tags" : [ 
                    {
                      "Key" : "Owner",
                      "Value" : { "Ref" : "Owner" }
                    }
                ]
            }
        }

    }
}